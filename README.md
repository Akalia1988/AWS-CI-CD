# AWS-CI-CD
Continuous Integration and Deployment with AWS Code Services

In the AWS Management Console search bar, enter CodeCommit, and click the CodeCommit result under Services

![image](https://user-images.githubusercontent.com/58148717/121222713-673c3200-c84c-11eb-9df8-a89a16c367b1.png)


![image](https://user-images.githubusercontent.com/58148717/121222748-6e634000-c84c-11eb-92ae-61527c69a51e.png)


Click Create.
AWS CodeCommit creates the repository in seconds. When the repository is ready, you will see connection instructions:

![image](https://user-images.githubusercontent.com/58148717/121222846-83d86a00-c84c-11eb-88e2-54f998c27fcc.png)

DO NOT forget to generate GIT Security Credentials for your user account.

IAM > User > Security credentials

![image](https://user-images.githubusercontent.com/58148717/121223150-d9ad1200-c84c-11eb-9372-e82d69f9f385.png)

After that either you can push the code through EC2 instance/local machine or simply can create/drop your code files. 

Next we will cover AWS codeBuild, AWS CodeBuild provides a service to support continuous integration

![image](https://user-images.githubusercontent.com/58148717/121223603-50e2a600-c84d-11eb-87d3-a53f0a47a4c3.png)

Click Create build project

![image](https://user-images.githubusercontent.com/58148717/121223812-85566200-c84d-11eb-8042-b8ba03f019dc.png)

Fill up the information however it meets YOUR own requirements or use snip below as an example.

Project name: ca-app-Arsh

Source provider: AWS CodeCommit (notice Amazon S3 and Github are also supported)

Repository: ca-app (your exact repository name will appear in the drop-down menu)

Branch: master

Environment image: Managed image

Operating System: Ubuntu

Runtime: Standard

Image: aws/codebuild/standard:5.0

Image Version: Always use the latest image for this runtime version

Service role: Existing service role

Role name: codebuild-app-role

Allow AWS CodeBuild to modify this service role so it can be used with this build project: unchecked

Build specification: Use a buildspec file

buildspec.yaml

![image](https://user-images.githubusercontent.com/58148717/121226054-c0f22b80-c84f-11eb-8516-25dafae245e0.png)


Artifacts type: Amazon S3
Bucket name: Select the bucket from the drop-down menu containing codebuildartifacts in the name
Name: ca-app-artifacts.zip
Artifacts packaging: Zip


![image](https://user-images.githubusercontent.com/58148717/121223877-9acb8c00-c84d-11eb-9fbb-760d893be691.png)


Create Build Project then Start Build 

This will take us to a view where we can review the Phase details as they progress, as well as view the Build logs output generated by our build

![image](https://user-images.githubusercontent.com/58148717/121224339-11688980-c84e-11eb-80f5-d630100ddd80.png)

![image](https://user-images.githubusercontent.com/58148717/121224358-14fc1080-c84e-11eb-8561-e92fe906e3b5.png)

After succesful build we can retrieve/view artifact in S3 bucket.

![image](https://user-images.githubusercontent.com/58148717/121224964-a9667300-c84e-11eb-954d-4119fd2af2c2.png)


Next we will Cover AWS CodeDeploy, 

AWS CodeDeploy is a platform-agnostic automated code deployment service. You can run AWS CodeDeploy anywhere, not just on EC2 instances. The service works by installing a CodeDeploy Agent on servers which respond to deployment tasks. AWS CodeDeploy makes it easy to handle rollbacks and provides support for two deployment types: in-place and blue/green. AWS CodeDeploy deployment groups target a group of instances to deploy the application. You can specify the instances using tags or Auto Scaling groups. AWS CodeDeploy also leverages an Elastic Load Balancer (Classic) to balance requests between deployment group instances.


![image](https://user-images.githubusercontent.com/58148717/121224856-92c01c00-c84e-11eb-821e-ae9f45ab1c18.png)


Click Create Application

![image](https://user-images.githubusercontent.com/58148717/121224911-9e134780-c84e-11eb-9c54-596dcf6ecf70.png)

![image](https://user-images.githubusercontent.com/58148717/121224999-b2efdb00-c84e-11eb-98ce-d50b595c8b8e.png)

Deployment type: In-place (The in-place deployment type will temporarily take instances out of service while they upgrade to a new revision. The impact on app users can be reduced by configuring the load balancer to use connection draining.)

![image](https://user-images.githubusercontent.com/58148717/121225195-e6cb0080-c84e-11eb-9b2a-4c00a340571d.png)

Amazon EC2 Auto Scaling groups: Checked

For Deployment settings choose CodeDeployDefault.OneAtATime

Uncheck Disable rollbacks and check Roll back when a deployment fails. Accept the defaults for the other advanced settings.

Click Create deployment group.

Please take a look at AppSpec.yaml file Every application needs an appspec.yml file at the root of the project directory in order to work with AWS CodeDeploy. This file instructs AWS CodeDeploy on how to deploy the application. It is similar to the buildspec.yml file that is used by AWS CodeBuild

![image](https://user-images.githubusercontent.com/58148717/121225882-956f4100-c84f-11eb-9555-f7777958231f.png)

It is a YAML file. The os can be set to linux or windows. The files section tells AWS CodeDeploy where to copy files from the build artifact bundle it receives. You can use the permissions section to change the file permissions of any file in the artifact bundle. Lastly, the hooks section allows you to run scripts at different life cycle events in a deployment. The life cycle events can trigger any arbitrary commands. The scripts your app has configured for different life cycle events are as follows:

ApplicationStop: Stops any running instance of the server

ApplicationStart: Starts running the server in production mode

ValidateService: Checks that the server responds to requests on port 8080


Lets Create blue-green deployment group as well

Enter the following values in the wizard:

Deployment group name: blue-green

Service role: codedeploy-ca-app-role

Deployment type: Blue/green

Environment configuration: Automatically copy Amazon EC2 Auto Scaling group

Select the only auto scaling group (It will contain ProdAutoScalingGroup in the name)
 
In Deployment settings, set the following:

Select Reroute traffic immediately. Traffic rerouting allows you to choose when traffic gets rerouted.

Select Keep the original instances in the deployment group running. This will keep the instances running in case you need to roll back. If you planned to keep the instances for some time, you would establish a policy for how long to keep them running.

Set the Deployment configuration to CodeDeployDefault.OneAtATime.

![image](https://user-images.githubusercontent.com/58148717/121226442-2e05c100-c850-11eb-8b76-b104b0eed365.png)

Next and Final Step CodePipeline, 

AWS CodePipeline is a highly available continuous integration and continuous delivery service in the cloud.Actions can be anything from building or deploying, to publishing to an SNS Topic for manual approval or executing an AWS Lambda function. Transitions are visually represented as arrows from one stage to the next

![image](https://user-images.githubusercontent.com/58148717/121226768-889f1d00-c850-11eb-9d02-363d6a37a462.png)

![image](https://user-images.githubusercontent.com/58148717/121226793-8d63d100-c850-11eb-8ffb-7e36c58589b9.png)

Click + Add stage at the bottom of the pipeline

![image](https://user-images.githubusercontent.com/58148717/121226995-bab07f00-c850-11eb-85fb-9f0cf8d0598d.png)


In the Production stage, click + Add action group.

In the Edit action form, enter the following:

Action name: CodeDeploy

Action provider: Deploy > AWS CodeDeploy

Input artifacts: BuildArtifact

Application name: ca-app 

Deployment group: in-place

![image](https://user-images.githubusercontent.com/58148717/121227111-d9af1100-c850-11eb-86ce-b373d134b112.png)

Run the pipeline manually: Click Release Change 

Notice the color of the left edge change to blue on the Source stage. This indicates the service is executing it.

![image](https://user-images.githubusercontent.com/58148717/121227351-11b65400-c851-11eb-9749-1a245c82825e.png)

After a minute a Succeeded status will appear inside the Source action and the stage turns green

After a minute or two it will succeed. Watch as the Production stage turns blue.Dive deeper into this stage by clicking on Details inside the action.
This takes you to the AWS CodeDeploy deployment details view.

![image](https://user-images.githubusercontent.com/58148717/121227516-44f8e300-c851-11eb-82ee-a4deef342275.png)

![image](https://user-images.githubusercontent.com/58148717/121227538-4b875a80-c851-11eb-86a3-ae30154c4421.png)

![image](https://user-images.githubusercontent.com/58148717/121227556-4f1ae180-c851-11eb-9f67-5cb588cb947f.png)

![image](https://user-images.githubusercontent.com/58148717/121227616-5fcb5780-c851-11eb-9648-cfbc342d1f35.png)

For Blue/green environment our release will look like snip below.

![image](https://user-images.githubusercontent.com/58148717/121227888-b3d63c00-c851-11eb-86d5-0ea561c9c40d.png)





































